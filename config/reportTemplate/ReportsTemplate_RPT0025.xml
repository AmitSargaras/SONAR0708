<?xml version="1.0" encoding="UTF-8"?>
<reports>
	<report>
		<query>
				select party_name,
                                 segmentName,
                                  facilityName,
                                  facilityType,
                                  facilityCat,
                                Currency,
                                  systemName,
                                 systemId,
                                 lineNo,
                                  serialNo,
                                interestRate,
                                 relesaedAmount,
                                  releaseDate,
                                  utilizedAmount,
                                 undrawnLimit,
                                  uploadStatus,
                                  reasonForFail


from

(SELECT sub_profile.lsp_short_name                       AS party_name,
                                 cc_segment.entry_name                                 AS segmentName,
                                 lmts.facility_name                                    AS facilityName,
                                 lmts.facility_type                                    AS facilityType,
                                 cc_fac_catg.entry_name                                AS facilityCat,
                                 lmts.lmt_crrncy_iso_code                              AS Currency,
                                 cc_system.entry_name                                  AS systemName,
                                 facDetail.facility_system_id                          AS systemId,
                                 facdetail.line_no                                     AS lineNo,
                                 facdetail.serial_no                                   AS serialNo,
                                 lmts.INTEREST_RATE                                    AS interestRate,
                                 facdetail.released_amount                             AS relesaedAmount,
                                 TO_CHAR(facdetail.release_date,'DD-Mon-YYYY')         AS releaseDate,
                                 facdetail.utilized_amount                             AS utilizedAmount,
                                 (facdetail.released_amount-facdetail.utilized_amount) AS undrawnLimit,
                                 uploadData.upload_satus                               AS uploadStatus,
                                 uploaddata.error_msg                                  AS reasonForFail
                               FROM SCI_LSP_APPR_LMTS lmts,
                                 SCI_LSP_LMT_PROFILE pf,
                                 SCI_LE_SUB_PROFILE sub_profile,
                                 SCI_LE_MAIN_PROFILE lmp ,
                                 (SELECT entry_name,
                                       entry_code
                                 FROM common_code_category_entry
                                 WHERE (category_code = 'HDFC_SEGMENT'
                                 OR category_code    IS NULL)
                                 ) cc_segment ,
                                 (SELECT entry_name,
                                       entry_code
                                 FROM common_code_category_entry
                                 WHERE (category_code = 'SYSTEM'
                                 OR category_code    IS NULL)
                                 ) cc_system ,
                                 (SELECT entry_name,
                                       entry_code
                                 FROM common_code_category_entry
                                 WHERE (category_code = 'FACILITY_CATEGORY'
                                 OR category_code    IS NULL)
                                 ) cc_fac_catg ,
                                 SCI_LSP_SYS_XREF facDetail ,
                                 SCI_LSP_LMTS_XREF_MAP xrefmap,
                                 CMS_LMT_UPD_DET_ERR_LOG uploadData
               where
                               sub_profile.cms_le_sub_profile_id = pf.cms_customer_id
                               AND cc_segment.entry_code(+)            =lmp.lmp_sgmnt_code_value
                               AND cc_system.entry_code(+)             =lmts.facility_system
                               AND cc_fac_catg.entry_code(+)           =lmts.facility_cat
                               AND pf.cms_lsp_lmt_profile_id           = lmts.CMS_LIMIT_PROFILE_ID
                               AND sub_profile.CMS_LE_MAIN_PROFILE_ID  = lmp.CMS_LE_MAIN_PROFILE_ID
                               AND lmts.CMS_LSP_APPR_LMTS_ID           =xrefmap.CMS_LSP_APPR_LMTS_ID
                               AND facDetail.CMS_LSP_SYS_XREF_ID       =xrefmap.CMS_LSP_SYS_XREF_ID
                               AND uploaddata.facility_sys_id          =facdetail.facility_system_id
                               AND uploaddata.serial_no                =facdetail.serial_no
                               AND uploadData.line_no                  = facdetail.line_no
                               AND uploaddata.UPLOAD_SATUS            != 'Matched'
                               AND uploaddata.UPLOAD_SATUS            != 'Failed'
                               AND uploaddata.UPLOAD_SATUS            != 'Unmatched'
                               AND lmts.cms_limit_status = 'ACTIVE'
                               AND To_Date(uploadData.TIME)            = To_Date(SYSDATE)
                               AND sub_profile.status                 != 'INACTIVE'

			       UNION ALL

SELECT DISTINCT

sub_profile.lsp_short_name                       AS party_name,
                                 cc_segment.entry_name                                 AS segmentName,
                                 lmts.facility_name                                    AS facilityName,
                                 lmts.facility_type                                    AS facilityType,
                                 cc_fac_catg.entry_name                                AS facilityCat,
                                 lmts.lmt_crrncy_iso_code                              AS Currency,
                                 cc_system.entry_name                                  AS systemName,
                                 facDetail.facility_system_id                          AS systemId,
                                 facdetail.line_no                                     AS lineNo,
                                 facdetail.serial_no                                   AS serialNo,
                                 lmts.INTEREST_RATE                                    AS interestRate,
                                 facdetail.released_amount                             AS relesaedAmount,
                                 TO_CHAR(facdetail.release_date,'DD-Mon-YYYY')         AS releaseDate,
                                 facdetail.utilized_amount                             AS utilizedAmount,
                                 (facdetail.released_amount-facdetail.utilized_amount) AS undrawnLimit,
                                 uploadData.upload_satus                               AS uploadStatus,
                                 uploaddata.error_msg                                  AS reasonForFail
                               FROM SCI_LSP_APPR_LMTS lmts,
                                 SCI_LSP_LMT_PROFILE pf,
                                 SCI_LE_SUB_PROFILE sub_profile,
                                 SCI_LE_MAIN_PROFILE lmp ,
                                 (SELECT entry_name,
                                       entry_code
                                 FROM common_code_category_entry
                                 WHERE (category_code = 'HDFC_SEGMENT'
                                 OR category_code    IS NULL)
                                 ) cc_segment ,
                                 (SELECT entry_name,
                                       entry_code
                                 FROM common_code_category_entry
                                 WHERE (category_code = 'SYSTEM'
                                 OR category_code    IS NULL)
                                 ) cc_system ,
                                 (SELECT entry_name,
                                       entry_code
                                 FROM common_code_category_entry
                                 WHERE (category_code = 'FACILITY_CATEGORY'
                                 OR category_code    IS NULL)
                                 ) cc_fac_catg ,
                                 SCI_LSP_SYS_XREF facDetail ,
                                 SCI_LSP_LMTS_XREF_MAP xrefmap,
                                 CMS_LMT_UPD_DET_ERR_LOG uploadData
               where
                               sub_profile.cms_le_sub_profile_id = pf.cms_customer_id
                               AND cc_segment.entry_code(+)            =lmp.lmp_sgmnt_code_value
                               AND cc_system.entry_code(+)             =lmts.facility_system
                               AND cc_fac_catg.entry_code(+)           =lmts.facility_cat
                               AND pf.cms_lsp_lmt_profile_id           = lmts.CMS_LIMIT_PROFILE_ID
                               AND sub_profile.CMS_LE_MAIN_PROFILE_ID  = lmp.CMS_LE_MAIN_PROFILE_ID
                               AND lmts.CMS_LSP_APPR_LMTS_ID           =xrefmap.CMS_LSP_APPR_LMTS_ID
                               AND facDetail.CMS_LSP_SYS_XREF_ID       =xrefmap.CMS_LSP_SYS_XREF_ID
                               AND uploaddata.facility_sys_id          =facdetail.facility_system_id
                               AND uploaddata.serial_no                =facdetail.serial_no
                               AND uploadData.line_no                  = facdetail.line_no
                              
                               AND uploaddata.UPLOAD_SATUS            = 'Failed'
                               AND uploaddata.error_msg like '%Available in CLIMS not in UBS.%'
                               AND lmts.cms_limit_status = 'ACTIVE'
                               AND To_Date(uploadData.TIME)            = To_Date(SYSDATE)
                               AND sub_profile.status                 != 'INACTIVE'
                               
                               
                               UNION ALL
                               
                      (  SELECT
 null         AS party_name,
  null as segmentName,
  NULL                       AS facilityName,
  NULL                       AS facilityType,
  NULL                       AS facilityCat,
  NULL                       AS Currency,
  'UBS-LIMITS'               AS systemName,
  uploaddata.facility_sys_id AS systemId,
  uploadData.line_no         AS lineNo,
  uploaddata.serial_no       AS serialNo,
  NULL                       AS interestRate,
  NULL                       AS relesaedAmount,
  NULL                       AS releaseDate,
  NULL                       AS utilizedAmount,
  NULL                       AS undrawnLimit,
  uploadData.upload_satus    AS uploadStatus,
  uploaddata.error_msg       AS reasonForFail
FROM CMS_LMT_UPD_DET_ERR_LOG uploadData
WHERE uploaddata.UPLOAD_SATUS = 'Failed'
AND uploaddata.facility_sys_id not in (select sys.cms_le_other_sys_cust_id  from sci_le_other_system sys where sys.CMS_LE_SYSTEM_NAME='UBS-LIMITS')
AND uploaddata.error_msg LIKE '%Available in UBS not in CLIMS.%'
AND To_Date(uploadData.TIME) = To_Date(sysdate)

union

SELECT
 sub_profile.lsp_short_name         AS party_name,
  cc_segment.entry_name  as segmentName,
  NULL                       AS facilityName,
  NULL                       AS facilityType,
  NULL                       AS facilityCat,
  NULL                       AS Currency,
  'UBS-LIMITS'               AS systemName,
  uploaddata.facility_sys_id AS systemId,
  uploadData.line_no         AS lineNo,
  uploaddata.serial_no       AS serialNo,
  NULL                       AS interestRate,
  NULL                       AS relesaedAmount,
  NULL                       AS releaseDate,
  NULL                       AS utilizedAmount,
  NULL                       AS undrawnLimit,
  uploadData.upload_satus    AS uploadStatus,
  uploaddata.error_msg       AS reasonForFail
FROM CMS_LMT_UPD_DET_ERR_LOG uploadData,
sci_le_sub_profile sub_profile,
(SELECT entry_name, entry_code
FROM common_code_category_entry
WHERE (category_code = 'HDFC_SEGMENT'
OR category_code    IS NULL)
) cc_segment ,
sci_le_other_system sys
WHERE uploaddata.UPLOAD_SATUS = 'Failed'
and sub_profile.cms_le_main_profile_id = sys.cms_le_main_profile_id
AND cc_segment.entry_code(+)            =sub_profile.lsp_sgmnt_code_value
and sys.cms_le_other_sys_cust_id = uploaddata.facility_sys_id
and sys.CMS_LE_SYSTEM_NAME='UBS-LIMITS'
AND uploaddata.error_msg LIKE '%Available in UBS not in CLIMS.%'
AND To_Date(uploadData.TIME) = To_Date(sysdate) )
) temp

			</query>
		<whereClause>
			<mandatoryClause>
				1=1
			</mandatoryClause>
		</whereClause>
		<reportParamters>
			<reportColumns>
				<reportColumn>
					<width>50</width>
					<format>textFormat</format>
					<header>Party Name</header>
				</reportColumn>
				<reportColumn>
					<width>50</width>
					<format>textFormat</format>
					<header>Segment</header>
				</reportColumn>
				<reportColumn>
					<width>50</width>
					<format>textFormat</format>
					<header>Facility Name</header>
				</reportColumn>
				<reportColumn>
					<width>50</width>
					<format>textFormat</format>
					<header>Facility Type</header>
				</reportColumn>				
				<reportColumn>
					<width>50</width>
					<format>textFormat</format>
					<header>Facility Category</header>
				</reportColumn>
				<reportColumn>
					<width>50</width>
					<format>textFormat</format>
					<header>Currency</header>
				</reportColumn>
				<reportColumn>
					<width>25</width>
					<format>textFormat</format>
					<header>System</header>
				</reportColumn>
				<reportColumn>
					<width>25</width>
					<format>textFormat</format>
					<header>System Id</header>
				</reportColumn>
				<reportColumn>
					<width>25</width>
					<format>textFormat</format>
					<header>Line No</header>
				</reportColumn>
				<reportColumn>
					<width>25</width>
					<format>textFormat</format>
					<header>Serial No</header>
				</reportColumn>
				<reportColumn>
					<width>25</width>
					<format>textFormat</format>
					<header>Interest Rate</header>
				</reportColumn>
				<reportColumn>
					<width>25</width>
					<format>textFormat</format>
					<header>Released Amount</header>
				</reportColumn>
				<reportColumn>
					<width>25</width>
					<format>textFormat</format>
					<header>Released Date</header>
				</reportColumn>
				<reportColumn>
					<width>25</width>
					<format>textFormat</format>
					<header>Utilised Amount</header>
				</reportColumn>
				<reportColumn>
					<width>25</width>
					<format>textFormat</format>
					<header>Undrawn Limit</header>
				</reportColumn>
				<reportColumn>
					<width>25</width>
					<format>textFormat</format>
					<header>Upload Status</header>
				</reportColumn>				
				<reportColumn>
					<width>200</width>
					<format>textFormat</format>
					<header>Reason For Failure</header>
				</reportColumn>				
			</reportColumns>			
			<reportName>UBS/FW Upload LSS Recon</reportName>
		</reportParamters>
	</report>
</reports>