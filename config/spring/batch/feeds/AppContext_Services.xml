<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns:aop="http://www.springframework.org/schema/aop"
		xsi:schemaLocation="
			http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
			http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd">

	<!-- Property File -->

	<!--<bean id="propertyFeedItemReader" class="org.springframework.batch.item.file.FlatFileItemReader" scope="prototype">-->
		<!--<property name="resource" value="${resource.property.feed.path}" />-->
		<!--<property name="fieldSetMapper">-->
			<!--<bean class="com.integrosys.cms.batch.feeds.property.PropertyFieldSetMapperImpl" />			-->
		<!--</property>-->
		<!--<property name="firstLineIsHeader" value="false" />-->
	<!--</bean>-->

	<!--<bean id="propertyFileLoaderBatchJob" class="com.integrosys.cms.batch.feeds.property.PropertyFileLoader">-->
		<!--<property name="propertyFileReader" ref="propertyFeedItemReader" />-->
		<!--<property name="propertyFileDao" ref="propertyFileDao" />-->
		<!--<property name="transactionTemplate">-->
			<!--<bean class="org.springframework.transaction.support.TransactionTemplate">-->
				<!--<property name="transactionManager" ref="txManager" />-->
			<!--</bean>-->
		<!--</property>-->
		<!--<property name="batchFeedErrorLogger">-->
			<!--<bean class="com.integrosys.cms.batch.common.FileSystemBatchFeedErrorLogger">-->
				<!--<property name="logFileLocation" value="${log.property.feed.path}" />-->
			<!--</bean>-->
		<!--</property>-->
	<!--</bean>-->

	<bean id="propertyPlFeedItemReader" class="org.springframework.batch.item.file.FlatFileItemReader" scope="prototype">
		<property name="resource" value="${resource.property.pl.feed.path}" />
        <property name="linesToSkip" value="11" />
        <property name="fieldSetMapper">
			<bean class="com.integrosys.cms.batch.feeds.property.PropertyFieldSetMapperImpl" />
		</property>
		<property name="firstLineIsHeader" value="false" />
	</bean>

	<bean id="propertyPlFileLoaderBatchJob" class="com.integrosys.cms.batch.feeds.property.PropertyFileLoader">
		<property name="propertyFileReader" ref="propertyPlFeedItemReader" />
		<property name="propertyFileDao" ref="propertyFileDao" />
		<property name="transactionTemplate">
			<bean class="org.springframework.transaction.support.TransactionTemplate">
				<property name="transactionManager" ref="txManager" />
			</bean>
		</property>
		<property name="batchFeedErrorLogger">
			<bean class="com.integrosys.cms.batch.common.FileSystemBatchFeedErrorLogger">
				<property name="logFileLocation" value="${log.property.pl.feed.path}" />
			</bean>
		</property>
		<property name="jdbcTemplate">
			<bean class="org.springframework.jdbc.core.JdbcTemplate">
				<property name="dataSource" ref="ofaPool" />
			</bean>
		</property>
		<property name="tempTableName" value="SI_TEMP_OTHR_PF003" />
		<property name="validationProcedureName" value="SI_VALIDATE_TEMP_OTHR_PF003" />
		<property name="runProcedureName" value="SI_RUN_TEMP_OTHR_PF003" />
    </bean>

    <bean id="propertyNplFeedItemReader" class="org.springframework.batch.item.file.FlatFileItemReader" scope="prototype">
		<property name="resource" value="${resource.property.npl.feed.path}" />
        <property name="linesToSkip" value="11" />
        <property name="fieldSetMapper">
			<bean class="com.integrosys.cms.batch.feeds.property.PropertyFieldSetMapperImpl" />
		</property>
		<property name="firstLineIsHeader" value="false" />
	</bean>

	<bean id="propertyNplFileLoaderBatchJob" class="com.integrosys.cms.batch.feeds.property.PropertyFileLoader">
		<property name="propertyFileReader" ref="propertyNplFeedItemReader" />
		<property name="propertyFileDao" ref="propertyFileDao" />
		<property name="transactionTemplate">
			<bean class="org.springframework.transaction.support.TransactionTemplate">
				<property name="transactionManager" ref="txManager" />
			</bean>
		</property>
		<property name="batchFeedErrorLogger">
			<bean class="com.integrosys.cms.batch.common.FileSystemBatchFeedErrorLogger">
				<property name="logFileLocation" value="${log.property.npl.feed.path}" />
			</bean>
		</property>
		<property name="jdbcTemplate">
			<bean class="org.springframework.jdbc.core.JdbcTemplate">
				<property name="dataSource" ref="ofaPool" />
			</bean>
		</property>
		<property name="tempTableName" value="SI_TEMP_OTHR_PF003" />
		<property name="validationProcedureName" value="SI_VALIDATE_TEMP_OTHR_PF003" />
		<property name="runProcedureName" value="SI_RUN_TEMP_OTHR_PF003" />
    </bean>


    <!-- stock File -->

	<bean id="stockPriceFeedItemReader" class="org.springframework.batch.item.file.FlatFileItemReader" scope="prototype">
		<property name="resource" value="${resource.stock.feed.path}" />
		<property name="fieldSetMapper">
			<bean class="com.integrosys.cms.batch.feeds.stock.StockPriceFieldSetMapperImpl" />
		</property>
		<property name="firstLineIsHeader" value="true" />
		<property name="lineTokenizer">
			<bean class="org.springframework.batch.item.file.transform.PrefixMatchingCompositeLineTokenizer">
				<property name="tokenizers">
					<map>
						<entry key="D">
							<bean class="org.springframework.batch.item.file.transform.DelimitedLineTokenizer" />
						</entry>
						<entry key="T">
							<bean class="com.integrosys.cms.batch.common.ReturnNullLineTokenizer" />
						</entry>
					</map>
				</property>
			</bean>
		</property>
	</bean>
	
	<bean id="stockPriceFileLoaderBatchJob" class="com.integrosys.cms.batch.feeds.stock.StockPriceFileLoader">
		<property name="stockPriceFileReader" ref="stockPriceFeedItemReader" />
		<property name="stockPriceFileDAO" ref="stockPriceFileDAO" />
		<property name="feedBatchSize" value="${feed.batch.size}" />
		<property name="transactionTemplate">
			<bean class="org.springframework.transaction.support.TransactionTemplate">
				<property name="transactionManager" ref="txManager" />
			</bean>
		</property>
		<property name="batchFeedErrorLogger">
			<bean class="com.integrosys.cms.batch.common.FileSystemBatchFeedErrorLogger">
				<property name="logFileLocation" value="${log.stock.feed.path}" />
			</bean>
		</property>
		<property name="jdbcTemplate">
			<bean class="org.springframework.jdbc.core.JdbcTemplate">
				<property name="dataSource" ref="ofaPool" />
			</bean>
		</property>
		<property name="tempTableName" value="SI_TEMP_MIMB_PF002" />
		<property name="validationProcedureName" value="SI_VALIDATE_TEMP_MIMB_PF002" />
		<property name="runProcedureName" value="SI_RUN_TEMP_MIMB_PF002" />
		<property name="valuationProfileSingletonListener" ref="valuationProfileSingletonListener" />
	</bean>
	
	<!-- for the insurance policy -->
	<bean name="insurancePolicyFeedsLineTokenizer" class="org.springframework.batch.item.file.transform.FixedLengthTokenizer">
		<property name="columns">
			<value>
				2,21,24,43,83,86-104,129-148,152,166,178,190,202,214,226,231,243,255-262
			</value>
		</property>
	</bean>
	
	<bean id="insurancePolicyFeedsFieldSetMapper" class="com.integrosys.cms.batch.common.mapping.DefaultListRecordsFieldSetMapper">
    	<property name="columnMetaInfos">
    		<value>
    			1=string
    			2=string
    			3=integer
    			4=string
    			5=string
    			6=string
    			7=string
    			8=bigdecimal
    			9=bigdecimal
    			10=bigdecimal
    			11=bigdecimal
    			12=bigdecimal
    			13=bigdecimal
    			14=bigdecimal
    			15=bigdecimal
    			16=bigdecimal
    			17=date,DATEFORMAT_ddMMyyyy
			</value>
		</property>
    </bean>

    <bean id="insurancePolicyFeedsFlatFileItemReader" class="org.springframework.batch.item.file.FlatFileItemReader" scope="prototype">
		<property name="firstLineIsHeader" value="false" />
		<property name="fieldSetMapper" ref="insurancePolicyFeedsFieldSetMapper" />
		<property name="resource" value="${resource.insurance.policy.feed.path}" />
		<property name="lineTokenizer" ref="insurancePolicyFeedsLineTokenizer" />
	</bean>
	
	<bean id="insurancePolicyFeedsLoaderBatchJob" class="com.integrosys.cms.batch.feeds.insurancepolicy.InsurancePolicyFeedsLoaderBatchJob">
		<property name="actualFlatFileItemReader" ref="insurancePolicyFeedsFlatFileItemReader" />
		<property name="feedPersistentBatchSize" value="${feed.persistent.batch.size}" />
        <property name="feedBatchSize" value="${feed.persistent.batch.size}" />
		<property name="listRecordsJdbcDao" ref="insurancePolicyFeedsJdbcDao" />
		<property name="transactionTemplate">
			<bean class="org.springframework.transaction.support.TransactionTemplate">
				<property name="transactionManager" ref="txManager" />
			</bean>
		</property>
		<property name="batchFeedErrorLogger">
			<bean class="com.integrosys.cms.batch.common.SystemInterfaceJdbcBatchFeedErrorLogger">
				<property name="jdbcTemplate">
					<bean class="org.springframework.jdbc.core.JdbcTemplate">
						<property name="dataSource" ref="ofaPool" />
					</bean>
				</property>
				<property name="systemId" value="UNIASIA" />
				<property name="interfaceId" value="INSRPOL" />
				<property name="lineTokenizer" ref="insurancePolicyFeedsLineTokenizer" />
				<property name="keyValueFieldSetIndexMap">
					<map key-type="java.lang.String" value-type="java.lang.Integer">
						<entry key="key1_value" value="3" />
						<entry key="key2_value" value="6" />
					</map>
				</property>
			</bean>
		</property>
		<property name="jdbcTemplate">
			<bean class="org.springframework.jdbc.core.JdbcTemplate">
				<property name="dataSource" ref="ofaPool" />
			</bean>
		</property>
		<property name="tempTableName" value="SI_TEMP_INSR_POLICY" />
		<property name="validationProcedureName" value="SI_VALIDATE_TEMP_INSR_POLICY" />
		<property name="runProcedureName" value="SI_RUN_TEMP_INSR_POLICY" />
		<property name="successLoadedFeedsFilePath" value="${resource.insurance.policy.success.feed.path}" />
		<property name="failLoadedFeedsFilePath" value="${resource.insurance.policy.fail.feed.path}" />
		<property name="successLoadedFeedsLineAggregator">
		    <bean class="org.springframework.batch.item.file.transform.FixedLengthLineAggregator">
		    	<property name="columns" value="1,2,21,24,43,83,86-104,105,111,119,122,129-148,149,152,166,178,190,202,214,226,231,243,255-262" />
		    	<property name="alignment" value="RIGHT" />
		    </bean>
		</property>
		<property name="failLoadedFeedsLineAggregator">
			<bean class="org.springframework.batch.item.file.transform.FixedLengthLineAggregator">
		    	<property name="columns" value="1,51,101,151,201,251-270,271-770" />
		    </bean>
		</property>
	</bean>

</beans>