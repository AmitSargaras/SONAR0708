create or replace PROCEDURE SP_Update_IFSC
AS
  CURSOR CR_MIG_IFSC
  IS
    SELECT  
		LSP_LE_ID,LSP_SHORT_NAME,IFSC_CODE,ID,CMS_LE_MAIN_PROFILE_ID,REVISED_EMAIL_ID
  FROM TEMP_CHANGES_IFSC WHERE UPDATE_STATUS = 'N';
    
 RC_FLAG_UPDATE CR_MIG_IFSC%ROWTYPE;
  COUNT_ACTUAL NUMBER(10);
BEGIN
  OPEN CR_MIG_IFSC;
  LOOP
    FETCH CR_MIG_IFSC INTO RC_FLAG_UPDATE;
    EXIT
     WHEN CR_MIG_IFSC%NOTFOUND;
    COUNT_ACTUAL := 0;
 
  SELECT COUNT(1)
    INTO COUNT_ACTUAL
    FROM CMS_IFSC_CODE 
	WHERE ID =  RC_FLAG_UPDATE.ID;
   
	
    IF(COUNT_ACTUAL>0) THEN

    UPDATE CMS_IFSC_CODE
    SET REVISED_EMAIL_ID = RC_FLAG_UPDATE.REVISED_EMAIL_ID
    WHERE  ID =  RC_FLAG_UPDATE.ID
	AND IFSC_CODE = RC_FLAG_UPDATE.IFSC_CODE;



     UPDATE CMS_STAGE_IFSC_CODE
    SET REVISED_EMAIL_ID = RC_FLAG_UPDATE.REVISED_EMAIL_ID
    where  ID = (
    select MAX(ID) 
    from CMS_STAGE_IFSC_CODE 
    where  IFSC_CODE= RC_FLAG_UPDATE.IFSC_CODE
   );
	
	
   UPDATE TEMP_CHANGES_IFSC 
   SET UPDATE_STATUS = 'Y'
   WHERE  ID =  RC_FLAG_UPDATE.ID;

END IF;
  END LOOP;
  CLOSE CR_MIG_IFSC;
  COMMIT;
END;