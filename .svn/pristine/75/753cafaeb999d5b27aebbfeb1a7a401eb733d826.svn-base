create or replace PROCEDURE sp_mig_cam_ui_facility
AS
  CURSOR FAC_MIG_CUR
  IS
    SELECT   
	TENOR, 
TENOR_UNIT,
MARGIN,
Customer_Cif, 
Facility_Id, 
FACILITY_NAME,
CMS_LSP_APPR_LMTS_ID, 
Staging_Lmt_Id
	FROM DAY_ZERO_MIG_CAM_UI_FACILITY WHERE UPDATE_STATUS = 'N' and IS_VALIDATED='Y';
    
 RC_FLAG_UPDATE FAC_MIG_CUR%ROWTYPE;
  COUNT_ACTUAL NUMBER(10);
BEGIN
  OPEN FAC_MIG_CUR;
  LOOP
    FETCH FAC_MIG_CUR INTO RC_FLAG_UPDATE;
    EXIT
     WHEN FAC_MIG_CUR%NOTFOUND;
    COUNT_ACTUAL := 0;
 
  SELECT COUNT(1)
    INTO COUNT_ACTUAL
    FROM SCI_LSP_APPR_LMTS 
	WHERE CMS_LSP_APPR_LMTS_ID =  RC_FLAG_UPDATE.CMS_LSP_APPR_LMTS_ID;
   
	IF(COUNT_ACTUAL>0) THEN

    UPDATE SCI_LSP_APPR_LMTS	
    SET TENOR = RC_FLAG_UPDATE.TENOR,
        TENOR_UNIT = RC_FLAG_UPDATE.TENOR_UNIT,
		MARGIN = RC_FLAG_UPDATE.MARGIN
    WHERE  CMS_LSP_APPR_LMTS_ID =  RC_FLAG_UPDATE.CMS_LSP_APPR_LMTS_ID;

     UPDATE STAGE_LIMIT
     SET TENOR = RC_FLAG_UPDATE.TENOR,
        TENOR_UNIT = RC_FLAG_UPDATE.TENOR_UNIT, 
		MARGIN = RC_FLAG_UPDATE.MARGIN
     where  CMS_LSP_APPR_LMTS_ID = RC_FLAG_UPDATE.Staging_Lmt_Id;

   UPDATE DAY_ZERO_MIG_CAM_UI_FACILITY 
   SET UPDATE_STATUS = 'Y'
   WHERE CMS_LSP_APPR_LMTS_ID =  RC_FLAG_UPDATE.CMS_LSP_APPR_LMTS_ID;

END IF;
  END LOOP;
  CLOSE FAC_MIG_CUR;
  COMMIT;
END;
