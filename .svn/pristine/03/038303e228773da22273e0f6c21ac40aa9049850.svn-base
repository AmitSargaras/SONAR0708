create or replace PROCEDURE SP_PARTY_SCREEN_BANK_MIG
AS
  CURSOR PARTY_MIG
  IS
    SELECT 
    LSP_LE_ID,
    LSP_SHORT_NAME,
    CMS_LE_SUB_PROFILE_ID,
    CMS_LE_MAIN_PROFILE_ID,
    LSP_SGMNT_CODE_VALUE,
    BANKING_METHOD,
    MULTBNK_FUNDBSE_HDFCBNK_PER,
    MULTBNK_NONFUNDBSE_LEADBNK_PER,
    MULTBNK_NONFUNDBSE_HDFCBNK_PER,
    MULTBNK_FUNDBSE_LEADBNK_PER,
    CONSBNK_FUNDBSE_LEADBNK_PER,
    CONSBNK_FUNDBSE_HDFCBNK_PER,
    CONSBNK_NONFUNDBSE_LEADBNK_PER,
    CONSBNK_NONFUNDBSE_HDFCBNK_PER
FROM TEMP_CHANGES_PARTY_BANK
WHERE UPDATE_STATUS = 'N';
      
 RC_FLAG_UPDATE PARTY_MIG%ROWTYPE;
  COUNT_ACTUAL NUMBER(10);
BEGIN
  OPEN PARTY_MIG;
  LOOP
    FETCH PARTY_MIG INTO RC_FLAG_UPDATE;
    EXIT
     WHEN PARTY_MIG%NOTFOUND;
    COUNT_ACTUAL := 0;
 
  SELECT COUNT(1)
    INTO COUNT_ACTUAL
    FROM SCI_LE_SUB_PROFILE 
	WHERE LSP_LE_ID = RC_FLAG_UPDATE.LSP_LE_ID;
  
  IF(COUNT_ACTUAL>0) THEN
	IF RC_FLAG_UPDATE.BANKING_METHOD = 'MULTIPLE' 
	THEN
    UPDATE SCI_LE_SUB_PROFILE
    SET 
        MULTBNK_NONFUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.MULTBNK_NONFUNDBSE_LEADBNK_PER,
		MULTBNK_NONFUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.MULTBNK_NONFUNDBSE_HDFCBNK_PER,
		MULTBNK_FUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.MULTBNK_FUNDBSE_LEADBNK_PER,
		MULTBNK_FUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.MULTBNK_FUNDBSE_HDFCBNK_PER
    
    WHERE LSP_LE_ID = RC_FLAG_UPDATE.LSP_LE_ID;
	
	UPDATE SCI_LE_MAIN_PROFILE
    SET 
        MULTBNK_NONFUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.MULTBNK_NONFUNDBSE_LEADBNK_PER,
		MULTBNK_NONFUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.MULTBNK_NONFUNDBSE_HDFCBNK_PER,
		MULTBNK_FUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.MULTBNK_FUNDBSE_LEADBNK_PER,
		MULTBNK_FUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.MULTBNK_FUNDBSE_HDFCBNK_PER
	WHERE  LMP_LE_ID =  RC_FLAG_UPDATE.LSP_LE_ID;
	
     UPDATE STAGE_SCI_LE_SUB_PROFILE
     SET
        MULTBNK_NONFUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.MULTBNK_NONFUNDBSE_LEADBNK_PER,
		MULTBNK_NONFUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.MULTBNK_NONFUNDBSE_HDFCBNK_PER,
		MULTBNK_FUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.MULTBNK_FUNDBSE_LEADBNK_PER,
		MULTBNK_FUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.MULTBNK_FUNDBSE_HDFCBNK_PER
    WHERE LSP_LE_ID = RC_FLAG_UPDATE.LSP_LE_ID;
	
	UPDATE STAGE_SCI_LE_MAIN_PROFILE
    SET 
        MULTBNK_NONFUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.MULTBNK_NONFUNDBSE_LEADBNK_PER,
		MULTBNK_NONFUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.MULTBNK_NONFUNDBSE_HDFCBNK_PER,
		MULTBNK_FUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.MULTBNK_FUNDBSE_LEADBNK_PER,
		MULTBNK_FUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.MULTBNK_FUNDBSE_HDFCBNK_PER
    where  LMP_LE_ID =  RC_FLAG_UPDATE.LSP_LE_ID;
	
	  UPDATE TEMP_CHANGES_PARTY_BANK
      SET UPDATE_STATUS           = 'Y'
      WHERE LSP_LE_ID = RC_FLAG_UPDATE.LSP_LE_ID;
    
	
 ElSIF RC_FLAG_UPDATE.BANKING_METHOD = 'CONSORTIUM' then 
 
  UPDATE SCI_LE_SUB_PROFILE
    SET 
		CONSBNK_FUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.CONSBNK_FUNDBSE_LEADBNK_PER,
		CONSBNK_FUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.CONSBNK_FUNDBSE_HDFCBNK_PER,
		CONSBNK_NONFUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.CONSBNK_NONFUNDBSE_LEADBNK_PER,
		CONSBNK_NONFUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.CONSBNK_NONFUNDBSE_HDFCBNK_PER
    WHERE LSP_LE_ID = RC_FLAG_UPDATE.LSP_LE_ID;
	
	UPDATE SCI_LE_MAIN_PROFILE
    SET 
		CONSBNK_FUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.CONSBNK_FUNDBSE_LEADBNK_PER,
		CONSBNK_FUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.CONSBNK_FUNDBSE_HDFCBNK_PER,
		CONSBNK_NONFUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.CONSBNK_NONFUNDBSE_LEADBNK_PER,
		CONSBNK_NONFUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.CONSBNK_NONFUNDBSE_HDFCBNK_PER
	WHERE  LMP_LE_ID =  RC_FLAG_UPDATE.LSP_LE_ID;
	
     UPDATE STAGE_SCI_LE_SUB_PROFILE
     SET 
		CONSBNK_FUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.CONSBNK_FUNDBSE_LEADBNK_PER,
		CONSBNK_FUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.CONSBNK_FUNDBSE_HDFCBNK_PER,
		CONSBNK_NONFUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.CONSBNK_NONFUNDBSE_LEADBNK_PER,
		CONSBNK_NONFUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.CONSBNK_NONFUNDBSE_HDFCBNK_PER
    WHERE LSP_LE_ID = RC_FLAG_UPDATE.LSP_LE_ID;
	
	UPDATE STAGE_SCI_LE_MAIN_PROFILE
    SET 
		CONSBNK_FUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.CONSBNK_FUNDBSE_LEADBNK_PER,
		CONSBNK_FUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.CONSBNK_FUNDBSE_HDFCBNK_PER,
		CONSBNK_NONFUNDBSE_LEADBNK_PER = RC_FLAG_UPDATE.CONSBNK_NONFUNDBSE_LEADBNK_PER,
		CONSBNK_NONFUNDBSE_HDFCBNK_PER = RC_FLAG_UPDATE.CONSBNK_NONFUNDBSE_HDFCBNK_PER
    where  LMP_LE_ID =  RC_FLAG_UPDATE.LSP_LE_ID;
	
	  UPDATE TEMP_CHANGES_PARTY_BANK
      SET UPDATE_STATUS           = 'Y'
      WHERE LSP_LE_ID = RC_FLAG_UPDATE.LSP_LE_ID;
    
	
	END IF;
  END IF;
  END LOOP;
  CLOSE PARTY_MIG;
  COMMIT;
END;