---------------------------------------------------------------------------
--                      DATA-WAREHOUSE SETUP SCRIPT                      --
---------------------------------------------------------------------------

/**************************************************************************
 Requestor : Tan Kien Leong
 Desc : Update export date
 Date : 18 Jun 2007
*************************************************************************/

--DROP TABLE DW_PARAM;
CREATE TABLE DW_PARAM (
  EXPORT_DATE	date
) 
IN CMS_DATA;


INSERT INTO DW_PARAM
VALUES(DATE(CURRENT TIMESTAMP));

--DROP VIEW VW_DW_PLEDGOR;
CREATE VIEW VW_DW_PLEDGOR AS 
SELECT ccc.COUNTRY,
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
plg.CMS_PLEDGOR_DTL_ID,
plg.PLG_LE_ID,
plg.PLG_LEGAL_NAME,
plg.PLG_INC_NUM_TEXT,
plg.PLG_INC_CNTRY_ISO_CODE,
'ID_TYPE' as ID_TYPE_NUM,
plg.PLG_ID_TYPE as ID_TYPE_VALUE,
plg.CREATE_DATE
FROM SCI_PLEDGOR_DTL plg, ( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
			WHERE CATEGORY_CODE='37' ) AS ccc
WHERE plg.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_AA;
CREATE VIEW VW_DW_AA AS 
SELECT llp.CMS_ORIG_COUNTRY AS COUNTRY,
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
llp.CMS_LSP_LMT_PROFILE_ID,
llp.LLP_LE_ID,
lmp.SOURCE_ID as LMP_LE_ID_SRC,
llp.SOURCE_ID,
llp.LLP_NEXT_ANNL_RVW_DATE,
llp.LLP_NEXT_INTRM_RVW_DATE,
llp.LLP_CRDT_PLCY_COMPLNCE_IND,
llp.LLP_UNWRT_STD_CMPLNCE_IND,
llp.LLP_EXTD_NEXT_RVW_DATE,
llp.LLP_PRJTD_ECON_PROFIT,
llp.LLP_EXPECT_LOSS_AMT,
llp.LLP_PROD_PRG_COMPLNCE_IND,
llp.LLP_CNTRY_RISK_APPR_REQ_IND,
llp.LLP_2ND_APPR_EMP_ID,
llp.LLP_1ST_APPR_EMP_ID,
llp.LLP_BCA_REF_NUM,
llp.LLP_BCA_REF_APPR_DATE,
llp.CMS_REQ_SEC_COVERAGE,
llp.CMS_ACT_SEC_COVERAGE,
llp.CMS_CUSTOMER_ID,
llp.CMS_BCA_STATUS,
llp.CMS_BCA_CREATE_DATE,
llp.CMS_BFL_REQUIRED_IND,
llp.CMS_ORIG_COUNTRY,
llp.CMS_ORIG_ORGANISATION,
llp.CMS_BCA_RENEWAL_IND,
llp.CMS_FULL_DOC_REVIEW_IND,
llp.CMS_BCA_LOCAL_IND,
llp.CMS_EXTENDED_BFL_DATE,
llp.CMS_CB_ACT_SEC_COVERAGE,
llp.LSP_LMT_PROFILE_SRC_ID_OLD,
llp.CMS_BCA_JOINT_IND,
llp.LMT_PROFILE_TYPE
FROM SCI_LSP_LMT_PROFILE llp, SCI_LE_SUB_PROFILE lsr, SCI_LE_MAIN_PROFILE lmp
WHERE llp.cms_customer_id = lsr.cms_le_sub_profile_id
AND lsr.CMS_LE_MAIN_PROFILE_ID = lmp.CMS_LE_MAIN_PROFILE_ID;


--DROP VIEW VW_DW_FACILITY;
CREATE VIEW VW_DW_FACILITY AS 
SELECT AL.CMS_BKG_COUNTRY AS COUNTRY,
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
AL.CMS_LSP_APPR_LMTS_ID,
AL.CMS_LIMIT_PROFILE_ID,
AL.LMT_ID,
AL.SOURCE_ID,
AL.LMT_PRD_TYPE_NUM,
AL.LMT_PRD_TYPE_VALUE,
AL.LMT_TYPE_NUM,
AL.LMT_TYPE_VALUE,
AL.LMT_AMT,
AL.LMT_SEC_TYPE_NUM,
AL.LMT_SEC_TYPE_VALUE,
AL.LMT_CRRNCY_ISO_CODE,
AL.LMT_OUTER_LMT_ID,
AL.LMT_EXPRY_DATE,
AL.LMT_INTRST_BASE_NUM,
AL.LMT_INTRST_BASE_VALUE,
AL.LMT_TENOR_BASIS_NUM,
AL.LMT_TENOR,
AL.LMT_INTRST_MARGIN,
AL.LMT_FEE,
AL.LMT_CONDTN_TEXT,
AL.LMT_ADVISE_IND,
AL.LMT_CMMTD_IND,
AL.LMT_SHARE_IND,
AL.LMT_LLP_ID,
AL.LMT_TENOR_BASIS_VALUE,
LP.LLP_LE_ID AS LMT_LE_ID,
AL.CMS_ACT_SEC_COVERAGE,
AL.CMS_REQ_SEC_COVERAGE,
AL.CMS_LIMIT_STATUS,
AL.CMS_ACTIVATED_LIMIT,
AL.CMS_BKG_COUNTRY,
AL.CMS_BKG_ORGANISATION,
AL.CMS_ACTIVATED_LIMIT_IND,
AL.CMS_OUTER_LMT_REF,
AL.CMDT_OP_LMT,
AL.CMS_OUTER_LMT_PROF_ID,
AL.ZERO_REASON,
AL.ZERO_DATE,
AL.ZERO_IND,
AL.LMT_PRD_GRP_NUM,
AL.LMT_PRD_GRP_VALUE,
AL.CMS_DRAWING_LIMIT,
AL.CMS_OUTSTANDING_AMT,
REMOVE_LINE( AL.LMT_DESC ) LMT_DESC,
AL.LMT_FAC_TYPE_NUM,
AL.LMT_FAC_TYPE_VALUE,
AL.LMT_BCA_REF_NUM,
AL.LMT_ID_OLD,
AL.LMT_OMNIBUS_IND,
'' as LMT_OUTSTANDING
FROM SCI_LSP_APPR_LMTS AL, SCI_LSP_LMT_PROFILE LP
WHERE LP.CMS_LSP_LMT_PROFILE_ID = AL.CMS_LIMIT_PROFILE_ID;

--DROP VIEW VW_DW_SEC_ASSET;
CREATE VIEW VW_DW_SEC_ASSET AS 
SELECT ccc.COUNTRY,
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
sec.CMS_COLLATERAL_ID,
sec.SECURITY_SUB_TYPE_ID,
sec.SUBTYPE_NAME,
sec.TYPE_NAME,
src.SOURCE_ID,
sec.CREATE_DATE,
sec.DELETED_DATE,
REMOVE_LINE( sec.SCI_REFERENCE_NOTE ) SCI_REFERENCE_NOTE,
sec.SECURITY_LOCATION,
sec.SECURITY_ORGANISATION,
sec.FSV_CURRENCY,
sec.FSV,
sec.CMV_CURRENCY,
sec.CMV,
sec.LE_CHARGE,
sec.LE_CHARGE_DATE,
sec.LAST_VALUATION_DATE,
sec.LAST_VALUATION_BY,
sec.LE_JURIDICT,
sec.LE_JURIDICT_DATE,
sec.LE_GOVRNLAW,
sec.LE_GOVRNLAW_DATE,
sec.PARI_PASSU,
sec.CUSTODIAN_TYPE,
sec.SECURITY_CUSTODIAN,
sec.SECURITY_MATURITY_DATE,
sec.EXCHANGE_CONTROL_OBTAINED,
sec.MARGIN,
sec.IS_SECURITY_PERFECTED,
sec.SECURITY_PERFECTION_DATE,
sec.SCI_SECURITY_DTL_ID,
sec.SCI_SEC_SYS_GEN_ID,
sec.SCI_SECURITY_SUBTYPE_VALUE,
sec.SCI_SECURITY_TYPE_VALUE,
sec.SCI_SECURITY_FSV,
sec.SCI_SECURITY_CURRENCY,
sec.SCI_ORIG_SECURITY_CURRENCY,
sec.SCI_SECURITY_FSV_DATE,
sec.SCI_SECURITY_BKG_LOCTN_ID,
sec.FSV_BALANCE,
sec.FSV_BALANCE_CCY,
sec.RPT_COLLATERAL_PARTICULARS,
sec.RPT_CHARGE_DETAILS,
sec.IS_LEGAL_ENFORCE,
sec.IS_LEGAL_ENFORCE_DATE,
sec.GEN_CHARGE_SURPLUS,
sec.REMARGIN,
sec.LAST_REMARGIN_DATE,
sec.NEXT_REMARGIN_DATE,
sec.RISK_MITIGATION_CATEGORY,
sec.EXT_SENIOR_LIEN,
sec.NET_REALIZABLE_VALUE,
sec.SOURCE_SECURITY_TYPE,
ast.PHY_INSPECTION_DONE,
ast.PHY_INSPECTION_FREQ_UNIT,
ast.PHY_INSPECTION_FREQ,
ast.LAST_PHY_INSPECT_DATE,
ast.NEXT_PHY_INSPECT_DATE,
ast.ENV_RISKY_STATUS,
ast.ENV_RISKY_DATE,
REMOVE_LINE( ast.ENV_RISKY_REMARK ) ENV_RISKY_REMARK,
REMOVE_LINE( ast.ASSET_DESCRIPTION ) ASSET_DESCRIPTION,
ast.TYPE_OF_ASSET,
ast.REG_NO,
ast.REG_FEE,
ast.REG_DATE,
ast.MANUFACTURE_YEAR,
ast.BRAND,
ast.MODEL_NO,
ast.PURCHASE_PRICE,
ast.PURCHASE_DATE,
ast.INVOICE_TYPE,
ast.AGENT_NAME,
ast.AGENT_LOCATION,
ast.APPROVED_BUYER,
ast.APPROVED_BUYER_LOCATION,
ast.BANK_ACC_NO,
ast.RECEIVABLES_BY_BANK,
ast.BANK_ACC_NO_LOCATION,
ast.AGENT_BANK_RECEIVABLES,
ast.AGENT_BANK_LOCATION,
ast.INSURER_NAME,
ast.INSURANCE_TYPE,
ast.INSURED_AGAINST,
ast.INSURABLE_AMT,
ast.INSURED_AMT,
ast.INS_EFFECTIVE_DATE,
ast.INS_EXPIRY_DATE,
ast.POLICY_NO,
ast.COVERAGE_TYPE,
ast.COVERAGE_TYPE_OTHERS,
ast.INS_BROKER_UNDERTAKE,
ast.AIRCRAFT_SERIAL_NO,
ast.MANUFACTURER_NAME,
ast.MANUFACTURE_WARRANTIES,
ast.ASSIGNORS,
ast.AMT_ASSMNT_ISURE,
ast.EFFECTIVE_DATE_ASMNT,
ast.EXP_DATE_ASMNT,
ast.EFFECTIVE_DATE_REINSURE,
ast.EXP_DATE_REINSURE,
ast.PROCESS_AGENT,
ast.PROCESS_AGENT_COUNTRY,
ast.GUARANTORS,
ast.EXPORT_CRD_AGENCY,
ast.SPECIALIST_LEGAL_OPINION,
ast.INSURE_ASMNT,
ast.REINSURE_ASMNT,
ast.INSURERS,
ast.NOMINAL_VALUE,
ast.MARGIN_DEBTOR,
ast.MARGIN_STOCK,
ast.CMV_DEBTOR,
ast.FSV_DEBTOR,
ast.CMV_STOCK,
ast.FSV_STOCK,
ast.INS_TOTAL_COVERAGE,
ast.INSR_CVR_STOCK_PERIOD,
ast.INSR_CVR_STOCK_PERIOD_UNIT,
ast.INSR_CVR_FAO_PERIOD,
ast.INSR_CVR_FAO_PERIOD_UNIT,
ast.MARGIN_FAO,
ast.CMV_FAO,
ast.FSV_FAO,
ast.LAST_USED_ID_IDX_STOCK,
ast.LAST_USED_ID_IDX_FAO,
ast.LAST_USED_ID_IDX_INSR,
ast.STOCK_INSR_GRACE_PERIOD,
ast.STOCK_INSR_GRACE_PERIOD_FREQ,
ast.FAO_INSR_GRACE_PERIOD,
ast.FAO_INSR_GRACE_PERIOD_FREQ,
ast.BANK_SHARE_PCT,
REMOVE_LINE( ast.OTHER_REMARKS ) OTHER_REMARKS,
ast.CURR_STK_INSR_SHORTFALL_AMT,
ast.PREV_STK_INSR_SHORTFALL_AMT,
ast.DRWG_PWR_LESS_INSR_GROSS_AMT,
ast.DRWG_PWR_GROSS_AMT,
ast.GOLD_GRADE,
ast.PURCHASE_RECEIPT_NO,
ast.GOLD_UNIT_PRICE,
ast.CERT_EXPIRY_DATE,
ast.GOLD_WEIGHT,
ast.GOLD_UOM,
ast.AUCTION_DATE,
ast.AUCTION_PRICE,
ast.AUCTIONEER,
ast.SALES_PROCEED,
ast.DEPRECIATE_RATE,
ast.GOLD_UNIT_PRICE_UOM,
ast.REG_CARD_NO,
ast.CHASSIS_NUMBER,
ast.PREV_OWNER_NAME,
ast.PREV_FINANCIER_NAME,
ast.REPOSSESSION_DATE,
ast.REPOSSESSION_AGE,
ast.YARD,
ast.ENGINE_NUMBER,
ast.GOOD_STATUS,
ast.COE_AMOUNT,
ast.TRANSMISSION_TYPE,
ast.ENERGY_SOURCE,
ast.HORSE_POWER,
ast.VEHICLE_COLOR,
ast.PROJECT_NAME,
ast.AWARDED_DATE,
ast.LETTER_INSTRUCT_FLAG,
ast.LETTER_UNDERTAKE_FLAG,
ast.BLANKET_ASSIGNMENT,
ast.VESSEL_NAME,
ast.REG_COUNTRY,
ast.VESSEL_STATE,
ast.EXPT_OCCUP_DATE,
ast.EXPT_OCCUP,
ast.OCCUP_TYPE,
ast.BUILD_YEAR,
ast.PURCHASE_CURRENCY,
ast.BUILDER,
ast.MAIN_REG,
ast.LENGTH,
ast.WIDTH,
ast.DEPTH,
ast.DECK_LOADING,
ast.DECK_WEIGHT,
ast.SIDE_BOARD,
ast.BOW,
ast.DECK,
ast.DECK_THICKNESS,
ast.BOTTOM,
ast.WINCH_DRIVE,
ast.BHP,
ast.SPEED,
ast.ANCHOR,
ast.ANCHOR_DRIVE,
ast.CLASS_SOCIETY,
ast.CONSTRUCT_COUNTRY,
ast.CONSTRUCT_PLACE,
ast.VESSEL_USE,
ast.CHARTER_CONTRACT,
ast.CHARTERER_NAME,
ast.CHARTER_PERIOD,
ast.CHARTER_PERIOD_UNIT,
ast.CHARTER_AMT,
ast.CHARTER_CURRENCY,
ast.CHARTER_RATE_UNIT,
ast.CHARTER_RATE_UNIT_OTH,
REMOVE_LINE( ast.CHARTER_REMARKS ) CHARTER_REMARKS,
ast.RESIDUAL_ASSET_LIFE,
ast.RESIDUAL_ASSET_LIFE_UOM,
ast.ASSET_VALUE,
ast.SCRAP_VALUE,
ast.DOC_PERFECT_AGE
FROM CMS_SECURITY sec, CMS_ASSET AST, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
		  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE sec.CMS_COLLATERAL_ID=ast.CMS_COLLATERAL_ID
AND sec.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND sec.SCI_SECURITY_TYPE_VALUE = 'AB'
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_CASH;
CREATE VIEW VW_DW_SEC_CASH AS 
SELECT ccc.COUNTRY,
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
sec.CMS_COLLATERAL_ID,
sec.SECURITY_SUB_TYPE_ID,
sec.SUBTYPE_NAME,
sec.TYPE_NAME,
src.SOURCE_ID,
sec.CREATE_DATE,
sec.DELETED_DATE,
REMOVE_LINE( sec.SCI_REFERENCE_NOTE ) SCI_REFERENCE_NOTE,
sec.SECURITY_LOCATION,
sec.SECURITY_ORGANISATION,
sec.FSV_CURRENCY,
sec.FSV,
sec.CMV_CURRENCY,
sec.CMV,
sec.LE_CHARGE,
sec.LE_CHARGE_DATE,
sec.LAST_VALUATION_DATE,
sec.LAST_VALUATION_BY,
sec.LE_JURIDICT,
sec.LE_JURIDICT_DATE,
sec.LE_GOVRNLAW,
sec.LE_GOVRNLAW_DATE,
sec.PARI_PASSU,
sec.CUSTODIAN_TYPE,
sec.SECURITY_CUSTODIAN,
sec.SECURITY_MATURITY_DATE,
sec.EXCHANGE_CONTROL_OBTAINED,
sec.MARGIN,
sec.IS_SECURITY_PERFECTED,
sec.SECURITY_PERFECTION_DATE,
sec.SCI_SECURITY_DTL_ID,
sec.SCI_SEC_SYS_GEN_ID,
sec.SCI_SECURITY_SUBTYPE_VALUE,
sec.SCI_SECURITY_TYPE_VALUE,
sec.SCI_SECURITY_FSV,
sec.SCI_SECURITY_CURRENCY,
sec.SCI_ORIG_SECURITY_CURRENCY,
sec.SCI_SECURITY_FSV_DATE,
sec.SCI_SECURITY_BKG_LOCTN_ID,
sec.FSV_BALANCE,
sec.FSV_BALANCE_CCY,
sec.RPT_COLLATERAL_PARTICULARS,
sec.RPT_CHARGE_DETAILS,
sec.IS_LEGAL_ENFORCE,
sec.IS_LEGAL_ENFORCE_DATE,
sec.GEN_CHARGE_SURPLUS,
sec.REMARGIN,
sec.LAST_REMARGIN_DATE,
sec.NEXT_REMARGIN_DATE,
sec.RISK_MITIGATION_CATEGORY,
sec.EXT_SENIOR_LIEN,
sec.NET_REALIZABLE_VALUE,
sec.SOURCE_SECURITY_TYPE,
csh.TOTAL_DEPOSIT_AMT,
csh.COUNT_DEPOSIT,
csh.INTEREST_CAPITIALISATION,
csh.MINIMAL_FSV,
csh.MINIMAL_FSV_CURRENCY,
csh.HOLDING_PERIOD,
csh.HOLDING_PERIOD_UOM
FROM CMS_SECURITY sec, CMS_CASH csh, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
		  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE sec.CMS_COLLATERAL_ID=csh.CMS_COLLATERAL_ID
AND sec.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND sec.SCI_SECURITY_TYPE_VALUE = 'CS'
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_INSURANCE;
CREATE VIEW VW_DW_SEC_INSURANCE AS 
SELECT ccc.COUNTRY,
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
sec.CMS_COLLATERAL_ID,
sec.SECURITY_SUB_TYPE_ID,
sec.SUBTYPE_NAME,
sec.TYPE_NAME,
src.SOURCE_ID,
sec.CREATE_DATE,
sec.DELETED_DATE,
REMOVE_LINE( sec.SCI_REFERENCE_NOTE ) SCI_REFERENCE_NOTE,
sec.SECURITY_LOCATION,
sec.SECURITY_ORGANISATION,
sec.FSV_CURRENCY,
sec.FSV,
sec.CMV_CURRENCY,
sec.CMV,
sec.LE_CHARGE,
sec.LE_CHARGE_DATE,
sec.LAST_VALUATION_DATE,
sec.LAST_VALUATION_BY,
sec.LE_JURIDICT,
sec.LE_JURIDICT_DATE,
sec.LE_GOVRNLAW,
sec.LE_GOVRNLAW_DATE,
sec.PARI_PASSU,
sec.CUSTODIAN_TYPE,
sec.SECURITY_CUSTODIAN,
sec.SECURITY_MATURITY_DATE,
sec.EXCHANGE_CONTROL_OBTAINED,
sec.MARGIN,
sec.IS_SECURITY_PERFECTED,
sec.SECURITY_PERFECTION_DATE,
sec.SCI_SECURITY_DTL_ID,
sec.SCI_SEC_SYS_GEN_ID,
sec.SCI_SECURITY_SUBTYPE_VALUE,
sec.SCI_SECURITY_TYPE_VALUE,
sec.SCI_SECURITY_FSV,
sec.SCI_SECURITY_CURRENCY,
sec.SCI_ORIG_SECURITY_CURRENCY,
sec.SCI_SECURITY_FSV_DATE,
sec.SCI_SECURITY_BKG_LOCTN_ID,
sec.FSV_BALANCE,
sec.FSV_BALANCE_CCY,
sec.RPT_COLLATERAL_PARTICULARS,
sec.RPT_CHARGE_DETAILS,
sec.IS_LEGAL_ENFORCE,
sec.IS_LEGAL_ENFORCE_DATE,
sec.GEN_CHARGE_SURPLUS,
sec.REMARGIN,
sec.LAST_REMARGIN_DATE,
sec.NEXT_REMARGIN_DATE,
sec.RISK_MITIGATION_CATEGORY,
sec.EXT_SENIOR_LIEN,
sec.NET_REALIZABLE_VALUE,
sec.SOURCE_SECURITY_TYPE,
REMOVE_LINE( ins.DESCRIPTION ) DESCRIPTION,
ins.ISDA_DATE,
ins.TREASURY_DATE,
ins.INSURER_NAME,
ins.INSURANCE_TYPE,
ins.BANK_RISK_CONFIRMATION,
ins.EFFECTIVE_DATE,
ins.EXPIRY_DATE,
ins.POLICY_NO,
ins.EXT_LEGAL_COUNSEL,
ins.ACCELERATION_CLAUSE,
ins.LOCAL_CCY_IN_CM,
ins.CORE_MARKET,
ins.BANK_INT_NOTED,
ins.INSURED_AMOUNT,
ins.INSURED_AMT_CURR
FROM CMS_SECURITY sec, CMS_INSURANCE ins, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE sec.CMS_COLLATERAL_ID=ins.CMS_COLLATERAL_ID
AND sec.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND sec.SCI_SECURITY_TYPE_VALUE = 'IN'
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_MARKETABLE_SEC;
CREATE VIEW VW_DW_SEC_MARKETABLE_SEC AS 
SELECT ccc.COUNTRY,
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
sec.CMS_COLLATERAL_ID,
sec.SECURITY_SUB_TYPE_ID,
sec.SUBTYPE_NAME,
sec.TYPE_NAME,
src.SOURCE_ID,
sec.CREATE_DATE,
sec.DELETED_DATE,
REMOVE_LINE( sec.SCI_REFERENCE_NOTE ) SCI_REFERENCE_NOTE,
sec.SECURITY_LOCATION,
sec.SECURITY_ORGANISATION,
sec.FSV_CURRENCY,
sec.FSV,
sec.CMV_CURRENCY,
sec.CMV,
sec.LE_CHARGE,
sec.LE_CHARGE_DATE,
sec.LAST_VALUATION_DATE,
sec.LAST_VALUATION_BY,
sec.LE_JURIDICT,
sec.LE_JURIDICT_DATE,
sec.LE_GOVRNLAW,
sec.LE_GOVRNLAW_DATE,
sec.PARI_PASSU,
sec.CUSTODIAN_TYPE,
sec.SECURITY_CUSTODIAN,
sec.SECURITY_MATURITY_DATE,
sec.EXCHANGE_CONTROL_OBTAINED,
sec.MARGIN,
sec.IS_SECURITY_PERFECTED,
sec.SECURITY_PERFECTION_DATE,
sec.SCI_SECURITY_DTL_ID,
sec.SCI_SEC_SYS_GEN_ID,
sec.SCI_SECURITY_SUBTYPE_VALUE,
sec.SCI_SECURITY_TYPE_VALUE,
sec.SCI_SECURITY_FSV,
sec.SCI_SECURITY_CURRENCY,
sec.SCI_ORIG_SECURITY_CURRENCY,
sec.SCI_SECURITY_FSV_DATE,
sec.SCI_SECURITY_BKG_LOCTN_ID,
sec.FSV_BALANCE,
sec.FSV_BALANCE_CCY,
sec.RPT_COLLATERAL_PARTICULARS,
sec.RPT_CHARGE_DETAILS,
sec.IS_LEGAL_ENFORCE,
sec.IS_LEGAL_ENFORCE_DATE,
sec.GEN_CHARGE_SURPLUS,
sec.REMARGIN,
sec.LAST_REMARGIN_DATE,
sec.NEXT_REMARGIN_DATE,
sec.RISK_MITIGATION_CATEGORY,
sec.EXT_SENIOR_LIEN,
sec.NET_REALIZABLE_VALUE,
sec.SOURCE_SECURITY_TYPE,
mar.TOTAL_CMV,
mar.TOTAL_PROTOFOLIO_ITEMS,
mar.MINIMAL_FSV,
mar.MINIMAL_FSV_CURRENCY
FROM CMS_SECURITY sec, CMS_MARKETABLE_SEC MAR, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
	          WHERE CATEGORY_CODE='37' ) AS ccc
WHERE sec.CMS_COLLATERAL_ID=mar.CMS_COLLATERAL_ID
AND sec.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND sec.SCI_SECURITY_TYPE_VALUE = 'MS'
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_DOCUMENTATION;
CREATE VIEW VW_DW_SEC_DOCUMENTATION AS 
SELECT ccc.COUNTRY, 
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
sec.CMS_COLLATERAL_ID,
sec.SECURITY_SUB_TYPE_ID,
sec.SUBTYPE_NAME,
sec.TYPE_NAME,
src.SOURCE_ID,
sec.CREATE_DATE,
sec.DELETED_DATE,
REMOVE_LINE( sec.SCI_REFERENCE_NOTE ) SCI_REFERENCE_NOTE,
sec.SECURITY_LOCATION,
sec.SECURITY_ORGANISATION,
sec.FSV_CURRENCY,
sec.FSV,
sec.CMV_CURRENCY,
sec.CMV,
sec.LE_CHARGE,
sec.LE_CHARGE_DATE,
sec.LAST_VALUATION_DATE,
sec.LAST_VALUATION_BY,
sec.LE_JURIDICT,
sec.LE_JURIDICT_DATE,
sec.LE_GOVRNLAW,
sec.LE_GOVRNLAW_DATE,
sec.PARI_PASSU,
sec.CUSTODIAN_TYPE,
sec.SECURITY_CUSTODIAN,
sec.SECURITY_MATURITY_DATE,
sec.EXCHANGE_CONTROL_OBTAINED,
sec.MARGIN,
sec.IS_SECURITY_PERFECTED,
sec.SECURITY_PERFECTION_DATE,
sec.SCI_SECURITY_DTL_ID,
sec.SCI_SEC_SYS_GEN_ID,
sec.SCI_SECURITY_SUBTYPE_VALUE,
sec.SCI_SECURITY_TYPE_VALUE,
sec.SCI_SECURITY_FSV,
sec.SCI_SECURITY_CURRENCY,
sec.SCI_ORIG_SECURITY_CURRENCY,
sec.SCI_SECURITY_FSV_DATE,
sec.SCI_SECURITY_BKG_LOCTN_ID,
sec.FSV_BALANCE,
sec.FSV_BALANCE_CCY,
sec.RPT_COLLATERAL_PARTICULARS,
sec.RPT_CHARGE_DETAILS,
sec.IS_LEGAL_ENFORCE,
sec.IS_LEGAL_ENFORCE_DATE,
sec.GEN_CHARGE_SURPLUS,
sec.REMARGIN,
sec.LAST_REMARGIN_DATE,
sec.NEXT_REMARGIN_DATE,
sec.RISK_MITIGATION_CATEGORY,
sec.EXT_SENIOR_LIEN,
sec.NET_REALIZABLE_VALUE,
sec.SOURCE_SECURITY_TYPE,
doc.ISDA_DATE,
doc.ISDA_PROD_DESC,
doc.IFEMA_DATE,
doc.IFEMA_PROD_DESC,
doc.ICOM_DATE,
doc.ICOM_PROD_DESC,
REMOVE_LINE( doc.DOC_DESC ) DOC_DESC,
doc.DOCUMENT_DATE,
doc.MIN_AMT,
doc.MIN_AMT_CCY,
doc.MAX_AMT,
doc.MAX_AMT_CCY,
doc.DOC_AMT,
doc.DOC_AMT_CCY,
doc.DOC_REF_NO,
doc.DEED_ASSIGNMT_TYPE,
doc.PROJECT_NAME,
doc.AWARDED_DATE,
doc.LETTER_INSTRUCT_FLAG,
doc.LETTER_UNDERTAKE_FLAG,
doc.BLANKET_ASSIGNMENT
FROM CMS_SECURITY sec, CMS_DOCUMENT DOC, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
	          WHERE CATEGORY_CODE='37' ) AS ccc
WHERE sec.CMS_COLLATERAL_ID=doc.CMS_COLLATERAL_ID
AND sec.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND sec.SCI_SECURITY_TYPE_VALUE = 'DC'
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_OTHERS;
CREATE VIEW VW_DW_SEC_OTHERS AS 
SELECT ccc.COUNTRY, 
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
sec.CMS_COLLATERAL_ID,
sec.SECURITY_SUB_TYPE_ID,
sec.SUBTYPE_NAME,
sec.TYPE_NAME,
src.SOURCE_ID,
sec.CREATE_DATE,
sec.DELETED_DATE,
REMOVE_LINE( sec.SCI_REFERENCE_NOTE ) SCI_REFERENCE_NOTE,
sec.SECURITY_LOCATION,
sec.SECURITY_ORGANISATION,
sec.FSV_CURRENCY,
sec.FSV,
sec.CMV_CURRENCY,
sec.CMV,
sec.LE_CHARGE,
sec.LE_CHARGE_DATE,
sec.LAST_VALUATION_DATE,
sec.LAST_VALUATION_BY,
sec.LE_JURIDICT,
sec.LE_JURIDICT_DATE,
sec.LE_GOVRNLAW,
sec.LE_GOVRNLAW_DATE,
sec.PARI_PASSU,
sec.CUSTODIAN_TYPE,
sec.SECURITY_CUSTODIAN,
sec.SECURITY_MATURITY_DATE,
sec.EXCHANGE_CONTROL_OBTAINED,
sec.MARGIN,
sec.IS_SECURITY_PERFECTED,
sec.SECURITY_PERFECTION_DATE,
sec.SCI_SECURITY_DTL_ID,
sec.SCI_SEC_SYS_GEN_ID,
sec.SCI_SECURITY_SUBTYPE_VALUE,
sec.SCI_SECURITY_TYPE_VALUE,
sec.SCI_SECURITY_FSV,
sec.SCI_SECURITY_CURRENCY,
sec.SCI_ORIG_SECURITY_CURRENCY,
sec.SCI_SECURITY_FSV_DATE,
sec.SCI_SECURITY_BKG_LOCTN_ID,
sec.FSV_BALANCE,
sec.FSV_BALANCE_CCY,
sec.RPT_COLLATERAL_PARTICULARS,
sec.RPT_CHARGE_DETAILS,
sec.IS_LEGAL_ENFORCE,
sec.IS_LEGAL_ENFORCE_DATE,
sec.GEN_CHARGE_SURPLUS,
sec.REMARGIN,
sec.LAST_REMARGIN_DATE,
sec.NEXT_REMARGIN_DATE,
sec.RISK_MITIGATION_CATEGORY,
sec.EXT_SENIOR_LIEN,
sec.NET_REALIZABLE_VALUE,
sec.SOURCE_SECURITY_TYPE,
oth.ENV_RISKY_STATUS,
oth.ENV_RISKY_DATE,
REMOVE_LINE( oth.ENV_RISKY_REMARKS ) ENV_RISKY_REMARKS,
REMOVE_LINE( oth.DESCRIPTION_OTHERS ) DESCRIPTION_OTHERS,
oth.IS_PHY_INSPECT,
oth.PHY_INSPECT_FREQ,
oth.PHY_INSPECT_FREQ_UNIT,
oth.LAST_PHY_INSPECT_DATE,
oth.NEXT_PHY_INSPECT_DATE,
oth.MINIMAL_VALUE,
oth.INSURER_NAME,
oth.INSURANCE_TYPE,
oth.INSURED_AGAINST,
oth.INSURABLE_AMT,
oth.INSURABLE_CURRENCY_CODE,
oth.INSURED_CURRENCY_CODE,
oth.INSURED_AMT,
oth.INS_EFFECTIVE_DATE
FROM CMS_SECURITY sec, CMS_OTHERS OTH, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
	          WHERE CATEGORY_CODE='37' ) AS ccc
WHERE sec.CMS_COLLATERAL_ID=oth.CMS_COLLATERAL_ID
AND sec.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND sec.SCI_SECURITY_TYPE_VALUE = 'OT'
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_GUARANTEES;
CREATE VIEW VW_DW_SEC_GUARANTEES AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
sec.CMS_COLLATERAL_ID,
sec.SECURITY_SUB_TYPE_ID,
sec.SUBTYPE_NAME,
sec.TYPE_NAME,
src.SOURCE_ID,
sec.CREATE_DATE,
sec.DELETED_DATE,
REMOVE_LINE( sec.SCI_REFERENCE_NOTE ) SCI_REFERENCE_NOTE,
sec.SECURITY_LOCATION,
sec.SECURITY_ORGANISATION,
sec.FSV_CURRENCY,
sec.FSV,
sec.CMV_CURRENCY,
sec.CMV,
sec.LE_CHARGE,
sec.LE_CHARGE_DATE,
sec.LAST_VALUATION_DATE,
sec.LAST_VALUATION_BY,
sec.LE_JURIDICT,
sec.LE_JURIDICT_DATE,
sec.LE_GOVRNLAW,
sec.LE_GOVRNLAW_DATE,
sec.PARI_PASSU,
sec.CUSTODIAN_TYPE,
sec.SECURITY_CUSTODIAN,
sec.SECURITY_MATURITY_DATE,
sec.EXCHANGE_CONTROL_OBTAINED,
sec.MARGIN,
sec.IS_SECURITY_PERFECTED,
sec.SECURITY_PERFECTION_DATE,
sec.SCI_SECURITY_DTL_ID,
sec.SCI_SEC_SYS_GEN_ID,
sec.SCI_SECURITY_SUBTYPE_VALUE,
sec.SCI_SECURITY_TYPE_VALUE,
sec.SCI_SECURITY_FSV,
sec.SCI_SECURITY_CURRENCY,
sec.SCI_ORIG_SECURITY_CURRENCY,
sec.SCI_SECURITY_FSV_DATE,
sec.SCI_SECURITY_BKG_LOCTN_ID,
sec.FSV_BALANCE,
sec.FSV_BALANCE_CCY,
sec.RPT_COLLATERAL_PARTICULARS,
sec.RPT_CHARGE_DETAILS,
sec.IS_LEGAL_ENFORCE,
sec.IS_LEGAL_ENFORCE_DATE,
sec.GEN_CHARGE_SURPLUS,
sec.REMARGIN,
sec.LAST_REMARGIN_DATE,
sec.NEXT_REMARGIN_DATE,
sec.RISK_MITIGATION_CATEGORY,
sec.EXT_SENIOR_LIEN,
sec.NET_REALIZABLE_VALUE,
sec.SOURCE_SECURITY_TYPE,
grt.BENEFICIARY_NAME,
REMOVE_LINE( grt.DESCRIPTION ) DESCRIPTION,
grt.GUARANTEE_AMT,
grt.CURRENCY_CODE,
grt.GUARANTEE_DATE,
grt.ISSUING_BANK,
grt.ISSUING_BANK_COUNTRY,
grt.REFERENCE_NO,
grt.BANK_COUNTRY_RISK_APPROVAL,
grt.MINIMAL_FSV,
grt.MINIMAL_FSV_CURRENCY,
grt.EXPIRY_DATE,
grt.PROJECT_NAME,
grt.AWARDED_DATE,
grt.LETTER_OF_INSTRUCTION_FLAG,
grt.LETTER_OF_UNDERTAKING_FLAG,
grt.BLANKET_ASSIGNMENT,
grt.COMMENTS,
grt.CORRESPONDENCE_BANK,
grt.WITHIN_CORRESPOND_BANK_LIMIT,
grt.CURRENT_SCHEME,
grt.HOLDING_PERIOD,
grt.HOLDING_PERIOD_TIME_UNIT
FROM CMS_SECURITY sec, CMS_GUARANTEE GRT, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE sec.CMS_COLLATERAL_ID=grt.CMS_COLLATERAL_ID
AND sec.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND sec.SCI_SECURITY_TYPE_VALUE = 'GT'
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_PROPERTY;
CREATE VIEW VW_DW_SEC_PROPERTY AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
sec.CMS_COLLATERAL_ID,
sec.SECURITY_SUB_TYPE_ID,
sec.SUBTYPE_NAME,
sec.TYPE_NAME,
src.SOURCE_ID,
sec.CREATE_DATE,
sec.DELETED_DATE,
REMOVE_LINE( sec.SCI_REFERENCE_NOTE ) SCI_REFERENCE_NOTE,
sec.SECURITY_LOCATION,
sec.SECURITY_ORGANISATION,
sec.FSV_CURRENCY,
sec.FSV,
sec.CMV_CURRENCY,
sec.CMV,
sec.LE_CHARGE,
sec.LE_CHARGE_DATE,
sec.LAST_VALUATION_DATE,
sec.LAST_VALUATION_BY,
sec.LE_JURIDICT,
sec.LE_JURIDICT_DATE,
sec.LE_GOVRNLAW,
sec.LE_GOVRNLAW_DATE,
sec.PARI_PASSU,
sec.CUSTODIAN_TYPE,
sec.SECURITY_CUSTODIAN,
sec.SECURITY_MATURITY_DATE,
sec.EXCHANGE_CONTROL_OBTAINED,
sec.MARGIN,
sec.IS_SECURITY_PERFECTED,
sec.SECURITY_PERFECTION_DATE,
sec.SCI_SECURITY_DTL_ID,
sec.SCI_SEC_SYS_GEN_ID,
sec.SCI_SECURITY_SUBTYPE_VALUE,
sec.SCI_SECURITY_TYPE_VALUE,
sec.SCI_SECURITY_FSV,
sec.SCI_SECURITY_CURRENCY,
sec.SCI_ORIG_SECURITY_CURRENCY,
sec.SCI_SECURITY_FSV_DATE,
sec.SCI_SECURITY_BKG_LOCTN_ID,
sec.FSV_BALANCE,
sec.FSV_BALANCE_CCY,
sec.RPT_COLLATERAL_PARTICULARS,
sec.RPT_CHARGE_DETAILS,
sec.IS_LEGAL_ENFORCE,
sec.IS_LEGAL_ENFORCE_DATE,
sec.GEN_CHARGE_SURPLUS,
sec.REMARGIN,
sec.LAST_REMARGIN_DATE,
sec.NEXT_REMARGIN_DATE,
sec.RISK_MITIGATION_CATEGORY,
sec.EXT_SENIOR_LIEN,
sec.NET_REALIZABLE_VALUE,
sec.SOURCE_SECURITY_TYPE,
pty.ENV_RISKY_STATUS,
pty.ENV_RISKY_DATE,
REMOVE_LINE( pty.ENV_RISKY_REMARKS ) ENV_RISKY_REMARKS, 
pty.IS_PHY_INSPECT,
pty.PHY_INSPECT_FREQ,
pty.PHY_INSPECT_FREQ_UNIT,
pty.LAST_PHY_INSPECT_DATE,
pty.NEXT_PHY_INSPECT_DATE,
pty.TITLE_TYPE,
pty.TITLE_NUMBER,
pty.LOT_NO,
pty.TOWN,
pty.LOT_LOCATION,
pty.POSTCODE,
pty.LAND_AREA,
pty.LAND_AREA_UOM,
pty.TENURE,
pty.TENURE_UNIT,
pty.REMAINING_TENURE,
pty.REMAIN_TENURE_UNIT,
pty.RESTRICT_CONDITION,
REMOVE_LINE( pty.EXPRESSED_CONDITION ) EXPRESSED_CONDITION,
pty.QUIT_RENT_PAID,
REMOVE_LINE( pty.DESCRIPTION_ASSET ) DESCRIPTION_ASSET,
pty.BUILTUP_AREA,
pty.BUILTUP_AREA_UOM,
pty.INSURER_NAME,
pty.INSURANCE_TYPE,
pty.INSURED_AGAINST,
pty.INSURABLE_AMT,
pty.INSURABLE_CURRENCY_CODE,
pty.INSURED_CURRENCY_CODE,
pty.INSURED_AMT,
pty.INS_EFFECTIVE_DATE,
pty.POLICY_NO,
pty.INS_EXPIRY_DATE,
pty.SALE_PURCHASE_VALUE,
pty.NOMINAL_VALUE,
REMOVE_LINE( pty.REMARKS_PROPERTY ) REMARKS_PROPERTY,
pty.REGISTERED_HOLDER,
REMOVE_LINE( pty.PROPERTY_ADDRESS ) PROPERTY_ADDRESS,
pty.STD_QUIT_RENT,
pty.NON_STD_QUIT_RENT,
pty.QUIT_RENT_RECEIPT,
pty.MUKIM,
pty.DISTRICT,
pty.STATE,
pty.REAL_ESTATE_WITH_RENTAL_FLAG,
pty.PROPERTY_USAGE,
pty.PROPERTY_COMPLETION_STATUS,
pty.DEVELOPER_NAME,
pty.ABANDONED_PROJECT,
pty.REDUCED_RISK_WEIGHT_FLAG,
pty.PROPERTY_COMPLETED_FLAG,
pty.PROPERTY_WELL_DEVELOPED_FLAG,
pty.LONG_ESTABLISHED_MARKET_FLAG,
pty.METHODOLOGY_FOR_VALUATION_FLAG,
pty.INDEPENDENT_VALUER_FLAG,
pty.CATEGORY_OF_LAND_USE,
pty.PROPERTY_TYPE,
pty.PHASE_NO,
pty.PROJECT_NAME,
pty.BREACH_IND,
pty.COMBINED_VALUE_IND,
pty.UNIT_PARCEL_NO,
pty.COMBINED_VALUE_AMT,
pty.VALUE_NUMBER,
pty.SCHEDULED_LOCATION
FROM CMS_SECURITY sec, CMS_PROPERTY PTY, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE sec.CMS_COLLATERAL_ID=pty.CMS_COLLATERAL_ID
AND sec.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND sec.SCI_SECURITY_TYPE_VALUE = 'PT'
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_CLEAN;
CREATE VIEW VW_DW_SEC_CLEAN AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
sec.CMS_COLLATERAL_ID,
sec.SECURITY_SUB_TYPE_ID,
sec.SUBTYPE_NAME,
sec.TYPE_NAME,
sec.SOURCE_ID,
sec.CREATE_DATE,
sec.DELETED_DATE,
REMOVE_LINE( sec.SCI_REFERENCE_NOTE ) SCI_REFERENCE_NOTE,
sec.SECURITY_LOCATION,
sec.SECURITY_ORGANISATION,
sec.FSV_CURRENCY,
sec.FSV,
sec.CMV_CURRENCY,
sec.CMV,
sec.LE_CHARGE,
sec.LE_CHARGE_DATE,
sec.LAST_VALUATION_DATE,
sec.LAST_VALUATION_BY,
sec.LE_JURIDICT,
sec.LE_JURIDICT_DATE,
sec.LE_GOVRNLAW,
sec.LE_GOVRNLAW_DATE,
sec.PARI_PASSU,
sec.CUSTODIAN_TYPE,
sec.SECURITY_CUSTODIAN,
sec.SECURITY_MATURITY_DATE,
sec.EXCHANGE_CONTROL_OBTAINED,
sec.MARGIN,
sec.IS_SECURITY_PERFECTED,
sec.SECURITY_PERFECTION_DATE,
sec.SCI_SECURITY_DTL_ID,
sec.SCI_SEC_SYS_GEN_ID,
sec.SCI_SECURITY_SUBTYPE_VALUE,
sec.SCI_SECURITY_TYPE_VALUE,
sec.SCI_SECURITY_FSV,
sec.SCI_SECURITY_CURRENCY,
sec.SCI_ORIG_SECURITY_CURRENCY,
sec.SCI_SECURITY_FSV_DATE,
sec.SCI_SECURITY_BKG_LOCTN_ID,
sec.FSV_BALANCE,
sec.FSV_BALANCE_CCY,
sec.RPT_COLLATERAL_PARTICULARS,
sec.RPT_CHARGE_DETAILS,
sec.IS_LEGAL_ENFORCE,
sec.IS_LEGAL_ENFORCE_DATE,
sec.GEN_CHARGE_SURPLUS,
sec.REMARGIN,
sec.LAST_REMARGIN_DATE,
sec.NEXT_REMARGIN_DATE,
sec.RISK_MITIGATION_CATEGORY,
sec.EXT_SENIOR_LIEN,
sec.NET_REALIZABLE_VALUE,
sec.SOURCE_SECURITY_TYPE
FROM CMS_SECURITY sec, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
	          WHERE CATEGORY_CODE='37' ) AS ccc
WHERE SCI_SECURITY_TYPE_VALUE = 'CL'
AND sec.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND sec.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_DEPOSIT;
CREATE VIEW VW_DW_SEC_DEPOSIT AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
csh.CMS_COLLATERAL_ID,
CASH_DEPOSIT_ID,
DEPOSIT_RECEIPT_NUMBER,
DEPOSIT_AMOUNT,
DEPOSIT_AMOUNT_CURRENCY,
DEPOSIT_MATURITY_DATE,
DEPOSIT_REFERENCE_NUMBER
FROM CMS_CASH_DEPOSIT CSH, CMS_SECURITY sec, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE csh.CMS_COLLATERAL_ID=sec.CMS_COLLATERAL_ID
AND csh.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_PORTFOLIO_ITEM;
CREATE VIEW VW_DW_SEC_PORTFOLIO_ITEM AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
itm.CMS_COLLATERAL_ID,
itm.ITEM_ID,
itm.TYPE,
itm.CERTIFICATE_NO,
itm.ISSUER_NAME,
itm.ISSUER_ID_TYPE,
itm.NO_OF_UNITS,
itm.UNIT_PRICE,
itm.UNIT_PRICE_CURRENCY,
itm.NOMINAL_VALUE,
itm.AGENT_NAME,
itm.AGENT_CONFIRM_DATE,
itm.REGISTERED_NAME,
itm.BOND_RATING,
itm.BOND_ISSUE_DATE,
itm.BOND_MATURITY_DATE,
itm.CURRENCY_CODE,
itm.IS_BLACKLISTED,
itm.SETTLEMENT_ORG,
itm.STOCK_EXCHANGE,
itm.STOCK_EXCHANGE_COUNTRY,
itm.INDEX_NAME,
itm.RIC,
itm.STOCK_CODE,
itm.ISIN_CODE,
itm.BASEL_COMPLIANT_TEXT,
itm.CMV,
itm.FSV,
itm.CMV_CURRENCY,
itm.FSV_CURRENCY,
itm.LOCAL_EXCHANGE,
itm.GOVT_GUARANTEE,
itm.NAME_OF_GOVT,
itm.LEAD_MANAGER,
itm.EXCHANGE_CONTROL_OBTAINED,
itm.SECURITY_CUSTODIAN,
itm.SECURITY_MATURITY_DATE,
itm.CUSTODIAN_TYPE,
itm.RECOVERY_DATE,
itm.HOLDING_PERIOD,
itm.HOLDING_PERIOD_UOM,
itm.RECOGNIZED_EXCHANGE_FLAG,
src.SOURCE_ID
FROM CMS_PORTFOLIO_ITEM ITM, CMS_SECURITY sec, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE itm.CMS_COLLATERAL_ID=sec.CMS_COLLATERAL_ID
AND itm.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_INSURANCE_POLICY;
CREATE VIEW VW_DW_SEC_INSURANCE_POLICY AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
pol.INSURANCE_POLICY_ID,
pol.INSURANCE_CATEGORY,
pol.POLICY_NO,
pol.CURRENCY_CODE,
pol.INSURER_NAME,
pol.INSURANCE_TYPE,
pol.EXPIRY_DATE,
pol.INSURABLE_AMT,
pol.INSURED_AMT,
pol.EFFECTIVE_DATE,
pol.INSURED_AGAINST,
REMOVE_LINE( pol.ADDRESS ) ADDRESS,
pol.INSR_ID,
pol.CMS_COLLATERAL_ID,
pol.DOCUMENT_NO,
pol.LMT_PROFILE_ID
FROM CMS_INSURANCE_POLICY pol, CMS_SECURITY sec, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE pol.CMS_COLLATERAL_ID=sec.CMS_COLLATERAL_ID
AND pol.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_VALUATION;
CREATE VIEW VW_DW_SEC_VALUATION AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
val.CMS_COLLATERAL_ID,
val.VALUATION_ID,
val.VALUATION_CURRENCY,
val.VALUATION_DATE,
val.VALUER,
val.CMV,
val.FSV,
val.VALUE_BEFORE_MARGIN,
val.REVAL_FREQ,
val.REVAL_FREQ_UNIT,
val.UPDATE_DATE,
val.NON_REVAL_FREQ,
val.NON_REVAL_FREQ_UNIT,
val.COMMENTS,
val.EVALUATION_DATE_FSV,
val.VALUATION_TYPE,
val.RESERVE_PRICE,
val.RESERVE_PRICE_DATE,
val.SOURCE_TYPE,
src.SOURCE_ID
FROM CMS_VALUATION VAL, CMS_SECURITY sec, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE val.CMS_COLLATERAL_ID=sec.CMS_COLLATERAL_ID
AND val.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_CHARGE;
CREATE VIEW VW_DW_SEC_CHARGE AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
map.LIMIT_CHARGE_MAP_ID,
map.CMS_COLLATERAL_ID,
map.CMS_LSP_APPR_LMTS_ID,
map.CHARGE_DETAIL_ID,
det.CHARGE_NATURE,
det.CHARGE_AMOUNT,
det.CHARGE_CURRENCY_CODE,
det.LEGAL_CHARGE_DATE,
det.LE_CHARGE,
det.LE_CHARGE_DATE,
det.LE_JURIDICT,
det.LE_JURIDICT_DATE,
det.LE_GOVNLAW,
det.LE_GOVNLAW_DATE,
det.PRIOR_CHARGE_AMOUNT,
det.PRIOR_CHARGE_CURRENCY,
det.SECURITY_RANK,
det.PRIOR_CHARGEE,
det.CHARGE_TYPE,
det.SCI_LAS_SEC_ID,
det.CONFIRM_CHARGE_DATE,
det.CMS_ACTUAL_CHARGE_AMOUNT,
det.CMS_ACTUAL_CHARGE_CCY,
det.PRIOR_CHARGE_TYPE,
det.IS_LEGAL_ENFORCE,
det.IS_LEGAL_ENFORCE_DATE,
det.CAVEAT_WAIVED_IND,
det.CAVEAT_REF_NO,
det.EXPIRY_DATE,
det.PRESENTATION_NO,
det.PRESENTATION_DATE,
det.LODGED_DATE,
det.SOLICITOR_NAME
FROM CMS_LIMIT_CHARGE_MAP map, CMS_CHARGE_DETAIL det, CMS_SECURITY sec, CMS_SECURITY_SOURCE src,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE map.CHARGE_DETAIL_ID = det.CHARGE_DETAIL_ID															
AND map.CMS_COLLATERAL_ID=sec.CMS_COLLATERAL_ID
AND map.CMS_COLLATERAL_ID=src.CMS_COLLATERAL_ID
AND src.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_ACCOUNT;
CREATE VIEW VW_DW_ACCOUNT AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
map.CMS_LSP_LMTS_XREF_MAP_ID,
map.CMS_LSP_APPR_LMTS_ID,
map.CMS_LSP_SYS_XREF_ID,
ref.LSX_BKG_LOCTN_ID,
ref.LSX_EXT_SYS_CODE_NUM,
ref.LSX_EXT_SYS_CODE_VALUE,
ref.LSX_EXT_SYS_ACCT_NUM,
lmt.CMS_OUTSTANDING_AMT as LMT_OUTSTANDING,
ref.LSX_ACCT_STATUS_TEXT,
ref.CMS_LE_SUB_PROFILE_ID,
ref.LSX_EXT_CTY_CODE_VALUE,
ref.ACCT_DELQ_IND,
ref.ACCT_EFFECTIVE_DATE,
ref.ACCT_STATUS
FROM SCI_LSP_LMTS_XREF_MAP map, SCI_LSP_SYS_XREF ref, SCI_LSP_APPR_LMTS lmt,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE map.CMS_LSP_SYS_XREF_ID = ref.CMS_LSP_SYS_XREF_ID	
AND map.CMS_LSP_APPR_LMTS_ID = lmt.CMS_LSP_APPR_LMTS_ID
AND lmt.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_STANDARD_CODE;
CREATE VIEW VW_DW_STANDARD_CODE AS 
SELECT 
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
ent.ENTRY_ID,
cat.CATEGORY_CODE,
cat.CATEGORY_NAME,
cat.CATEGORY_TYPE,
ent.ENTRY_CODE,
ent.ENTRY_NAME,
ent.ACTIVE_STATUS,
ent.ENTRY_SOURCE,
ent.COUNTRY,
ent.REF_ENTRY_CODE
FROM COMMON_CODE_CATEGORY cat, COMMON_CODE_CATEGORY_ENTRY ent
WHERE cat.CATEGORY_CODE = ent.CATEGORY_CODE;


--DROP VIEW VW_DW_SECURITY_SUB_TYPE;
CREATE VIEW VW_DW_SECURITY_SUB_TYPE AS 
SELECT 
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
SECURITY_TYPE_ID,
SECURITY_TYPE_NAME,
SECURITY_SUB_TYPE_ID,
SUBTYPE_NAME,
SUBTYPE_DESCRIPTION,
SUBTYPE_STANDARDISED_APPROACH,
SUBTYPE_FOUNDATION_IRB,
SUBTYPE_ADVANCED_IRB
FROM CMS_SECURITY_SUB_TYPE;


--DROP VIEW VW_DW_SECURITY_PARAMETER;
CREATE VIEW VW_DW_SECURITY_PARAMETER AS 
SELECT 
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
ID,
COUNTRY_ISO_CODE,
SECURITY_SUB_TYPE_ID,
THRESHOLD_PERCENT,
VALUATION_FREQUENCY_UNIT,
VALUATION_FREQUENCY
FROM CMS_SECURITY_PARAMETER;


--DROP VIEW VW_DW_LIMIT_SEC_MAP;
CREATE VIEW VW_DW_LIMIT_SEC_MAP AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
map.CHARGE_ID,
map.CMS_LSP_APPR_LMTS_ID,
map.CMS_COLLATERAL_ID
FROM CMS_LIMIT_SECURITY_MAP map, SCI_LSP_APPR_LMTS LMT,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE map.CMS_LSP_APPR_LMTS_ID = lmt.CMS_LSP_APPR_LMTS_ID
AND lmt.SOURCE_ID=ccc.ENTRY_CODE;


--DROP VIEW VW_DW_SEC_PLEDGOR_MAP;
CREATE VIEW VW_DW_SEC_PLEDGOR_MAP AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
map.CMS_SEC_PLDGR_MAP_ID,
map.CMS_PLEDGOR_DTL_ID,
map.CMS_COLLATERAL_ID
FROM SCI_SEC_PLDGR_MAP map, SCI_PLEDGOR_DTL dtl,
		( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                  WHERE CATEGORY_CODE='37' ) AS ccc
WHERE map.CMS_PLEDGOR_DTL_ID = dtl.CMS_PLEDGOR_DTL_ID
AND dtl.SOURCE_ID=ccc.ENTRY_CODE;



--DROP VIEW VW_DW_SHARE_SEC;
CREATE VIEW VW_DW_SHARE_SEC AS 
SELECT ccc.COUNTRY,  
(SELECT DT_FMT(EXPORT_DATE,'yyyymmdd') FROM DW_PARAM) AS EXPORT_DATE,
src.CMS_SECURITY_SOURCE_ID,
src.CMS_COLLATERAL_ID,
src.SOURCE_SECURITY_ID,
src.SOURCE_ID,
src.STATUS,
src.LAST_UPDATE_DATE
FROM CMS_SECURITY_SOURCE src, ( SELECT ENTRY_CODE, COUNTRY FROM COMMON_CODE_CATEGORY_ENTRY  
                                WHERE CATEGORY_CODE='37' ) AS ccc
WHERE src.SOURCE_ID=ccc.ENTRY_CODE;
