CREATE OR REPLACE PROCEDURE sp_mig_cam_ui_facility_REM
AS
  CURSOR NEW_CAM_FAC_MIG_CUR
  IS
    SELECT Llp_Le_Id,
      Lmt_Id,
      Facility_Name,
      CMS_LSP_APPR_LMTS_ID,
      NEW_FACILITY_CODE,
      Staging_Lmt_Id,
      PUT_CALL_OPTION,
      OPTION_DATE,
      Availability_Date
    FROM MIG_CAM_UI_FACILITY_SCREEN
    WHERE IS_VALIDATED = 'N';
  RC_FLAG_UPDATE NEW_CAM_FAC_MIG_CUR%ROWTYPE;
  COUNT_ACTUAL                     NUMBER(11);
  AVAIL_AND_OPTION_APPLICABLE_FLAG VARCHAR(50);
BEGIN
  OPEN NEW_CAM_FAC_MIG_CUR;
  LOOP
    FETCH NEW_CAM_FAC_MIG_CUR INTO RC_FLAG_UPDATE;
    EXIT
  WHEN NEW_CAM_FAC_MIG_CUR%NOTFOUND;
    COUNT_ACTUAL := 0;
    SELECT COUNT(1)
    INTO COUNT_ACTUAL
    FROM SCI_LSP_APPR_LMTS
    WHERE CMS_LSP_APPR_LMTS_ID = RC_FLAG_UPDATE.CMS_LSP_APPR_LMTS_ID;
    SELECT AVAIL_AND_OPTION_APPLICABLE
    INTO AVAIL_AND_OPTION_APPLICABLE_FLAG
    FROM CMS_FACILITY_NEW_MASTER
    WHERE NEW_FACILITY_CODE =RC_FLAG_UPDATE.NEW_FACILITY_CODE;
    DBMS_OUTPUT.PUT_LINE('AVAIL_AND_OPTION_APPLICABLE--'||AVAIL_AND_OPTION_APPLICABLE_FLAG||'*');
    IF(COUNT_ACTUAL > 0) THEN
    DBMS_OUTPUT.PUT_LINE('In 1 st if');
    IF(AVAIL_AND_OPTION_APPLICABLE_FLAG = 'on') THEN
      DBMS_OUTPUT.PUT_LINE('In 2 nd if');
        UPDATE SCI_LSP_APPR_LMTS
        SET PUT_CALL_OPTION        = RC_FLAG_UPDATE.PUT_CALL_OPTION,
          OPTION_DATE              = RC_FLAG_UPDATE.OPTION_DATE,
          LOAN_AVAIL_DATE          = RC_FLAG_UPDATE.Availability_Date
        WHERE CMS_LSP_APPR_LMTS_ID = RC_FLAG_UPDATE.CMS_LSP_APPR_LMTS_ID;
        UPDATE STAGE_LIMIT
        SET PUT_CALL_OPTION        = RC_FLAG_UPDATE.PUT_CALL_OPTION,
          OPTION_DATE              = RC_FLAG_UPDATE.OPTION_DATE,
          LOAN_AVAIL_DATE          = RC_FLAG_UPDATE.Availability_Date
        WHERE CMS_LSP_APPR_LMTS_ID = RC_FLAG_UPDATE.Staging_Lmt_Id;
        UPDATE MIG_CAM_UI_FACILITY_SCREEN
        SET UPDATE_STATUS          = 'Y'
        WHERE CMS_LSP_APPR_LMTS_ID = RC_FLAG_UPDATE.CMS_LSP_APPR_LMTS_ID;
      END IF;
    END IF;
  END LOOP;
  CLOSE NEW_CAM_FAC_MIG_CUR;
  COMMIT;
END;